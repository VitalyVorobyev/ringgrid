# Task: INFRA-007: Add Maintainability Guardrails to CI

- **Type:** infra
- **Priority:** P2
- **Requesting role:** Project Lead
- **Assigned workflow:** feature-development

## Problem Statement

Current CI validates formatting, lint, tests, and docs build, but it does not explicitly guard against maintainability debt regressions. In particular:

- function-size hotspots can silently grow,
- new `allow(dead_code)` can be introduced in hot modules without visibility,
- rustdoc missing-docs debt can grow over time.

This task adds baseline-locked CI guardrails so maintainability debt cannot regress unintentionally.

## Affected Pipeline Stages

Which of the 10 stages are impacted? List by number and name.

1. [ ] Proposal
2. [ ] Outer Estimate
3. [ ] Outer Fit
4. [ ] Decode
5. [ ] Inner Fit
6. [ ] Dedup
7. [ ] Projective Center (once per marker)
8. [ ] Global Filter
9. [ ] Completion (+ projective center for new markers)
10. [ ] Final H Refit

## Affected Modules

List file paths under `crates/ringgrid/src/`:

- None (CI/infrastructure policy task; no runtime module logic changed).

## Public API Impact

- [x] No API changes
- [ ] New public types (list them)
- [ ] Changed type signatures (list them)
- [ ] New config fields (list them, must have `Default`)
- [ ] New `Detector` methods (justify)

## Acceptance Criteria

- [x] CI includes a static maintainability guardrail step for hot modules.
- [x] Guardrail fails on new or expanded oversized hotspot functions (baseline-locked line budgets).
- [x] Guardrail fails on new `allow(dead_code)` occurrences in configured hot modules.
- [x] CI includes a rustdoc missing-docs non-regression guardrail.
- [x] Baseline policy for function-size hotspots, allowed dead-code exceptions, and rustdoc warning budget is versioned in-repo.
- [x] `cargo test --workspace --all-features` passes.
- [x] `cargo clippy --all-targets --all-features -- -D warnings` clean.
- [x] Synthetic eval metrics: not applicable (no runtime detector behavior change).

## Accuracy Constraints

- Center error target: no runtime algorithm changes in this task.
- Decode success rate: no runtime algorithm changes in this task.
- Homography reprojection: no runtime algorithm changes in this task.

## Performance Constraints

- Latency budget: no runtime algorithm changes in this task.
- Allocation limits: no runtime algorithm changes in this task.

## Python Tooling Changes

- [x] No Python changes needed
- [ ] New scoring metric in `score_detect.py`
- [ ] New visualization in `viz_detect_debug.py`
- [ ] New synthetic generation option in `gen_synth.py`
- [ ] Other: [describe]

## Notes

- CI/workflow files changed:
- `.github/workflows/ci.yml`
- `tools/ci/maintainability_guardrails.py`
- `tools/ci/maintainability_baseline.json`
